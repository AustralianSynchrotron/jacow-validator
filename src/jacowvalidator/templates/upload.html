{% extends "layout.html" %}
{% block content %}
    <section class="section">
        <div class="container is-clearfix">
        {% if commit_sha and commit_date %}<p class="is-size-7 is-pulled-right"><b>Updated:</b> {{ commit_date.strftime('%H:%M %d/%m/%Y') }} [<b>{{ commit_sha }}</b>]</p>{% endif %}
        </div>
        {% set action = 'upload' %}
        {% include "_fileupload.html" ignore missing %}

        <div class="container">
        {% if filename %}
                <h1 class="title">Report for {{ filename }}</h1>
        {% endif %}

        {% if error %}
            <div class="container box" style="background-color:#{{ false|pastel_background_style }}">{{ error }}</div>
        {% endif %}

        {% if processed %}
            {% import "section_macro.html" as section_helper %}
            <div class="container box" style="text-align:center;font-size:14pt;background-color:#{{ 2|pastel_background_style }}">
                <a href="https://www.jacow.org/Authors/CSEHelp" title="Author Help" target="_blank">Link to DOCX Cat Scan Editor - Help and Usage Guidelines</a>
            </div>

            <div class="container box" style="box-shadow: 0 4px 6px rgba(0, 0, 255, 0.1), 0 0 0 2px rgba(0, 0, 255, 0.1)">
                <h2 class="subtitle">Summary</h2>
                <div class="list is-hoverable">
                {% for i, item in summary.items() %}
                   <a href="#{{ item.anchor }}" class="list-item link-color" style="background-color:#{{ item.ok|pastel_background_style }}">
                    {{ item.ok|tick_cross|safe }} {{ item.title }} {% if item.show_total %} ({{ item.details|length }}){% endif %}
                       {% if item.ok == False %} - {{ item.message }}{% endif %}
                   </a>
                {% endfor%}
                </div>
            </div>

            <div class="box" style="box-shadow: 0 4px 6px rgba(0, 0, 255, 0.1), 0 0 0 2px rgba(0, 0, 255, 0.1)">
                <h2 class="subtitle"><a name="meta"></a>Word Document loaded successfully</h2>
                <p>Author: {{ metadata.author }}</p>
                <p>Internal Revision: {{ metadata.revision }}</p>
                <p>Created at (UTC): {{ metadata.created.strftime('%d/%m/%Y %H:%M') }}</p>
                <p>Modified at (UTC): {{ metadata.modified.strftime('%d/%m/%Y %H:%M') }}</p>
                {% if  metadata.version %}
                    <p>Version: {{ metadata.version }}</p>
                {% endif %}
                {% if  metadata.language %}
                    <p>Language: {{ metadata.language }}</p>
                {% endif %}
            </div>

            <p><button class="button" style="background-color:lightblue" onclick="js:closeDetails()">Close All Expanded Sections Below </button><br/><br/></p>
            {% set section = summary['Styles'] %}
            {% set extra_info = {'ok':section['ok'],'title':'Style Breakdown', 'headers': '<thead><tr>
                            <th>Style</th><th>Embedded in Document</th>
                        </tr></thead>',
                'columns': ['style', 'style_ok']}
            %}
            {{ section_helper.add_section(section, {}, extra_info) }}

            {% set section = summary['List'] %}
            {% set extra_info = {'ok':section['ok'],'title':'Breakdown', 'headers': '<thead><tr>
                            <th style="width:60%">Text</th><th style="width:15%">Style</th><th style="width:15%">In Table</th><th style="width:10%">JACoW Style</th>
                        </tr></thead>',
                'columns': ['text', 'style', 'in_table', 'style_ok']}
            %}
            {{ section_helper.add_section(section, {}, extra_info) }}


            {% set section = summary['Margins'] %}
            {% set extra_info = {'ok':section['ok'],'title':'Style Breakdown', 'headers': '<thead><tr>
                            <th>Section</th><th>Page Size</th><th colspan="2">Margins</th>
                            <th>Columns</th><th colspan="2">Column Gutter (cm)</th>
                        </tr> </thead>',
                'columns': ['loop.index', 'page_size', 'margins', 'margins_ok', 'col_number', 'col_gutter', 'col_ok']}
            %}
            {{ section_helper.add_section(section, {}, extra_info) }}


            {% set section = summary['Languages'] %}
            {% if summary['Languages']['ok'] == False %}
                {% set extra_info = 'Non English proofing languages were found in document, please set all document content proofing language to English.' %}
            {% else %}
                {% set extra_info = 'English proofing languages were found.' %}
            {% endif %}
            {{ section_helper.add_section(section, {}, extra_info) }}

            {% set section = summary['Title'] %}
            {% if not title.case_ok %}
                {% set extra_info = '<p class="has-text-weight-bold has-text-danger">Title should be at least 70% uppercase</p>' %}
            {% else %}
                {% set extra_info = '' %}
            {% endif %}
            {{ section_helper.add_section(section, {}, extra_info) }}

            {{ section_helper.add_section(summary['Authors'], {}) }}
            {{ section_helper.add_section(summary['Abstract'], {}) }}
            {{ section_helper.add_section(summary['Headings'], {}) }}
            {{ section_helper.add_section(summary['Paragraphs'], {'truncate_text':200}) }}


            {% set section = summary['References'] %}
            {% set extra_info = {'ok':section['ok'],'title':'Use Breakdown', 'headers': '<thead>
                            <tr>
                                <th>No.</th>
                                <th colspan="3">Text</th>
                                <th>Used</th>
                                <th>Order</th>
                                <th>Unique</th>
                            </tr>
                        </thead>',
                'columns': ['id', 'text', 'text_error', 'text_ok', 'used_ok', 'order_ok', 'unique_ok']}
            %}
            {{ section_helper.add_section(section, {'truncate_text':50}, extra_info) }}

            {% set section = summary['Figures'] %}
            {% set extra_info = {'ok':section['ok'],'title':'Use Breakdown', 'headers': '<thead>
                        <tr>
                            <th>No.</th>
                            <th colspan="2">Caption</th>
                            <th>Unique</th>
                            <th colspan="2">References</th>
                            <th width="30%">Text</th>
                        </tr>
                    </thead>',
                'columns': ['id', 'name', 'caption_ok', 'unique_ok', 'refs', 'used_ok', 'text'],'multi':true}
            %}
            {{ section_helper.add_section(section, {'style_multi':true}, extra_info) }}

            {% set section = summary['Tables'] %}
            {% set extra_info = {'ok':section['ok'],'title':'Use Breakdown', 'headers': '<thead>
                        <tr>
                            <th>No.</th>
                            <th colspan="3">Caption</th>
                            <th colspan="2">Used</th>
                            <th>Order</th>
                            <th>Table</th>
                        </tr>
                    </thead>',
                'columns': ['id', 'text', 'text_format_ok', 'text_format_message', 'used', 'used_ok', 'order_ok', 'table']}
            %}

            {{ section_helper.add_section(section, {'extra_info':'CSETables'}, extra_info) }}

            {% if summary['SPMS'] %}
                {% set section = summary['SPMS'] %}
                {% set extra_info = {'ok':section['ok'],'title':'Title and Author Breakdown', 'headers': '<thead>
                    <tr><th>Type</th><th>Match</th><th>Docx</th><th>SPMS</th></tr>
                </thead>',
                    'columns': ['type', 'match_ok', 'docx', 'spms']}
                %}
                {% if reference_csv_url is defined %}
                    {% set title = 'Conformance with <a href=' + reference_csv_url + '>references.csv</a>' %}
                {% else %}
                   {% set title = 'Conformance with references.csv' %}
                {% endif %}

                {{ section_helper.add_section(section, {'section_header':title,'extra_info':'CSESPMSCeck'}, extra_info) }}
            </div>
            {% endif %}
        {% endif %}
    </section>
   <script type="application/javascript">
        function closeDetails() {
            const details = document.querySelectorAll("details");
            details.forEach(function(targetDetail) {
                targetDetail.removeAttribute("open");
            });
        }
    </script>
{% endblock %}